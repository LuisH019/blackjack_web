<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Blackjack Spark Java</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            text-align: center; 
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1e4d2b 0%, #2c6e49 100%);
            color: #f0f0f0;
            min-height: 100vh;
        }
        
        .container {
            width: 90%;
            max-width: 900px;
            margin: 0 auto;
            background-color: rgba(44, 110, 73, 0.9);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }
        
        h1 { 
            color: #ffe082; 
            margin-bottom: 10px;
            font-size: 2em;
        }
        
        .status-message {
            font-size: 1.5em;
            font-weight: bold;
            color: #ffcdd2; 
            margin: 20px 0;
            min-height: 40px;
        }
        
        .hand-section {
            margin: 30px 0;
            padding: 20px;
            background-color: rgba(56, 142, 60, 0.5);
            border-radius: 10px;
        }
        
        .hand-title {
            color: #f0f4c3;
            font-size: 1.3em;
            margin-bottom: 15px;
        }
        
        .cards-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            min-height: 140px;
            align-items: center;
        }
        
        /* Carta de Baralho */
        .card {
            width: 80px;
            height: 120px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 8px;
            position: relative;
            transition: transform 0.2s;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card.red {
            color: #d32f2f;
        }
        
        .card.black {
            color: #212121;
        }
        
        .card-corner {
            font-size: 1.2em;
            font-weight: bold;
            line-height: 1;
        }
        
        .card-center {
            font-size: 2.5em;
            text-align: center;
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .card-corner.bottom {
            text-align: right;
            transform: rotate(180deg);
        }
        
        /* Carta Virada (Back) */
        .card.back {
            background: linear-gradient(135deg, #1565c0 0%, #0d47a1 100%);
            color: white;
        }
        
        .card.back .card-pattern {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.1) 10px, rgba(255,255,255,0.1) 20px),
                repeating-linear-gradient(-45deg, transparent, transparent 10px, rgba(255,255,255,0.05) 10px, rgba(255,255,255,0.05) 20px);
            border-radius: 8px;
        }
        
        /* BotÃµes */
        .actions {
            margin: 30px 0;
        }
        
        .actions button {
            padding: 12px 25px;
            font-size: 1.1em;
            margin: 5px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .actions .hit-btn { 
            background-color: #ffb74d; 
            color: #333;
        }
        
        .actions .stand-btn { 
            background-color: #64b5f6; 
            color: #333;
        }
        
        .actions .new-game-btn { 
            background-color: #81c784; 
            color: #333;
        }
        
        .actions button:hover:enabled { 
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .actions button:disabled { 
            background-color: #757575; 
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .hand-value {
            font-size: 1.5em;
            color: #ffe082;
            font-weight: bold;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ° Blackjack em Java Web ðŸŽ°</h1>

        <p class="status-message" th:text="${gameData.statusMessage}"></p>

        <div class="actions">
            <form action="/new-game" method="post" style="display:inline;"> 
                <button type="submit" class="new-game-btn">ðŸŽ² Novo Jogo</button>
            </form>

            <form action="/hit" method="post" style="display:inline;">
                <button type="submit" class="hit-btn" th:disabled="${gameData.isGameOver()} or !${gameData.isPlayersTurn()}">
                    âž• HIT (Pedir Carta)
                </button>
            </form>

            <form action="/stand" method="post" style="display:inline;">
                <button type="submit" class="stand-btn" th:disabled="${gameData.isGameOver()} or !${gameData.isPlayersTurn()}">
                    âœ‹ STAND (Manter)
                </button>
            </form>
        </div>

        <!-- MÃ£o do Dealer -->
        <div class="hand-section">
            <div class="hand-title">
                ðŸŽ© MÃ£o do Dealer
            </div>
            <div class="cards-container" id="dealer-cards">
                <!-- As cartas serÃ£o inseridas aqui via JavaScript -->
            </div>
            <div class="hand-value">
                Valor: 
                <span th:if="${gameData.isGameOver() or not gameData.isPlayersTurn()}" 
                      th:text="${gameData.getDealerValue(false)}"></span>
                <span th:unless="${gameData.isGameOver() or not gameData.isPlayersTurn()}" 
                      th:text="${gameData.getDealerValue(true)}"></span>
            </div>
        </div>

        <!-- MÃ£o do Jogador -->
        <div class="hand-section">
            <div class="hand-title">
                ðŸŽ® Sua MÃ£o (Jogador)
            </div>
            <div class="cards-container" id="player-cards">
                <!-- As cartas serÃ£o inseridas aqui via JavaScript -->
            </div>
            <div class="hand-value">
                Valor: <span th:text="${gameData.getPlayerValue()}"></span>
            </div>
        </div>
        
    </div>

    <script th:inline="javascript">
        // Dados do Thymeleaf
        const dealerCardsText = /*[[${gameData.getDealerHandDetails(gameData.isPlayersTurn())}]]*/ '';
        const playerCardsText = /*[[${gameData.getPlayerHandDetails()}]]*/ '';
        const isPlayerTurn = /*[[${gameData.isPlayersTurn()}]]*/ false;

        // SÃ­mbolos dos naipes
        const suitSymbols = {
            'Copas': 'â™¥',
            'Ouros': 'â™¦',
            'Paus': 'â™£',
            'Espadas': 'â™ '
        };

        // FunÃ§Ã£o para determinar a cor do naipe
        function getSuitColor(suit) {
            return (suit === 'Copas' || suit === 'Ouros') ? 'red' : 'black';
        }

        // FunÃ§Ã£o para criar o HTML de uma carta
        function createCard(rank, suit) {
            const color = getSuitColor(suit);
            const symbol = suitSymbols[suit] || suit;
            
            return `
                <div class="card ${color}">
                    <div class="card-corner">
                        ${rank}<br>${symbol}
                    </div>
                    <div class="card-center">
                        ${symbol}
                    </div>
                    <div class="card-corner bottom">
                        ${rank}<br>${symbol}
                    </div>
                </div>
            `;
        }

        // FunÃ§Ã£o para criar carta virada (back)
        function createBackCard() {
            return `
                <div class="card back">
                    <div class="card-pattern"></div>
                </div>
            `;
        }

        // FunÃ§Ã£o para processar texto de cartas "2 de Copas, J de Paus"
        function parseAndRenderCards(cardsText, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            if (!cardsText || cardsText.trim() === '') {
                return;
            }

            const cards = cardsText.split(',').map(c => c.trim());
            
            cards.forEach(cardText => {
                if (cardText.includes('[Carta Oculta]')) {
                    container.innerHTML += createBackCard();
                } else {
                    // Parse "2 de Copas" -> rank: "2", suit: "Copas"
                    const parts = cardText.split(' de ');
                    if (parts.length === 2) {
                        const rank = parts[0].trim();
                        const suit = parts[1].trim();
                        container.innerHTML += createCard(rank, suit);
                    }
                }
            });
        }

        // Renderizar as cartas
        parseAndRenderCards(dealerCardsText, 'dealer-cards');
        parseAndRenderCards(playerCardsText, 'player-cards');
    </script>
</body>
</html>